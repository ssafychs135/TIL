# 파이썬 정적 타이핑과 성능 최적화 (Mypyc) 총정리

이 문서는 파이썬의 정적 타입 힌트(Static Type Hints)의 개념부터, 이를 활용한 정적 분석, 그리고 Mypyc 컴파일러를 통한 성능 최적화까지의 과정을 요약합니다.

---

## 1. 파이썬의 정적 타입 힌트 (Type Hints)

파이썬 3.5부터 도입된 타입 힌트는 코드에 타입 정보를 명시하는 기능입니다.

**주요 목적:**
- **코드 가독성 향상**: 함수와 변수가 어떤 타입을 기대하는지 명확히 보여줍니다.
- **정적 분석**: `Mypy`와 같은 도구가 코드를 실행하기 전에 타입 관련 오류를 찾아냅니다.
- **IDE 지원 강화**: 코드 자동 완성, 리팩토링 등의 기능이 향상됩니다.

**중요**: 파이썬 인터프리터(CPython)는 기본적으로 타입 힌트를 **무시하며, 런타임에 타입을 강제하지 않습니다.**

### 기본 문법

```python
# 변수 타입 힌트
name: str = "Alice"
age: int = 30

# 함수 타입 힌트 (매개변수와 반환 값)
def greeting(name: str) -> str:
    return f"Hello, {name}"

# 반환 값이 없는 경우 -> None
def print_message(message: str) -> None:
    print(message)
```

### 복합 타입 (`typing` 모듈)

리스트, 딕셔너리 등 복잡한 타입을 지정할 때는 `typing` 모듈을 사용합니다.

```python
from typing import List, Dict, Tuple, Optional, Any

# 정수 리스트
numbers: List[int] = [1, 2, 3]

# 문자열 키, 정수 값을 갖는 딕셔너리
scores: Dict[str, int] = {"Alice": 100}

# None이 될 수 있는 값
nickname: Optional[str] = None

# 모든 타입을 허용 (타입 검사 비활성화)
anything: Any = "hello"
```

---

## 2. 정적 타입 검사기: Mypy

`Mypy`는 타입 힌트를 읽어 코드의 타입 일관성을 검사하는 **정적 분석 도구**입니다.

1.  **설치**: `pip install mypy`
2.  **기본 실행**: `mypy your_script.py`

### Mypy 사용 예시

**1. 기본적인 타입 오류 검출**

`mypy`는 함수에 잘못된 타입의 인자가 전달되는 경우를 가장 흔하게 잡아냅니다.

```python
# test.py
def add(a: int, b: int) -> int:
    return a + b

add("hello", "world") # Mypy가 이 부분을 오류로 감지
```

```bash
$ mypy test.py
test.py:5: error: Argument 1 to "add" has incompatible type "str"; expected "int"
...
```

**2. 특정 오류 무시하기 (`# type: ignore`)**

때로는 `mypy`의 검사를 의도적으로 피해야 할 때가 있습니다. 예를 들어, 타입 정보가 없는 외부 라이브러리를 사용하거나, 동적인 코드 구조로 인해 `mypy`가 타입을 추론하지 못하는 경우입니다.

이때는 해당 코드 라인 뒤에 `# type: ignore` 주석을 추가하여 오류를 무시하도록 할 수 있습니다.

```python
from some_untyped_library import untyped_function

# mypy가 untyped_function의 타입을 알 수 없어 오류를 발생시키지만,
# 개발자는 이 코드가 올바르다는 것을 알고 있을 때 사용합니다.
result = untyped_function(1, 2)  # type: ignore
```

**3. 타입이 지정되지 않은 함수 호출 금지**

엄격한 타입 검사를 위해, 타입 힌트가 없는 함수를 정의하거나 호출하는 것을 막을 수 있습니다. `--disallow-untyped-defs` 와 `--disallow-untyped-calls` 옵션을 사용합니다.

```python
# untyped_def.py
def greeting(name):
    return f"Hello, {name}"
```

```bash
$ mypy --disallow-untyped-defs untyped_def.py
untyped_def.py:1: error: Function is missing a type annotation
```

이 옵션들은 프로젝트의 모든 코드가 타입 힌트를 갖도록 강제하여 코드의 안정성을 높이는 데 도움이 됩니다.

---

## 3. 타입 힌트와 실행 속도의 관계

> **결론: 타입 힌트만으로는 실행 속도가 빨라지지 않습니다.**

-   **이유**: 표준 파이썬 인터프리터는 타입 힌트를 최적화에 사용하지 않고 무시합니다.
-   **오버헤드**: `typing` 모듈을 임포트하고 타입 객체를 생성하는 과정에서 아주 미미한 런타임 오버헤드가 발생할 수 있으나, 대부분 무시할 수 있는 수준입니다.

속도 향상을 위해서는 타입 힌트를 활용하는 **별도의 컴파일러**가 필요합니다.

---

## 4. Mypyc: 타입 힌트를 이용한 파이썬 컴파일러

**Mypyc**는 타입 힌트가 있는 파이썬 코드를 **고성능 C 확장 모듈로 컴파일**해주는 도구입니다.

### 핵심 원리

Mypyc는 타입 힌트를 신뢰하여 파이썬의 동적 처리 과정을 생략하고 C 레벨에서 직접 데이터를 다루는 최적화된 코드를 생성합니다.

-   **조기 바인딩**: `x: int`를 보고 C의 네이티브 정수 타입으로 처리합니다.
-   **오버헤드 제거**: 무거운 파이썬 객체 대신 가벼운 C의 기본 타입을 사용합니다.
-   **효율적인 함수 호출**: C 레벨의 빠른 함수 호출을 수행합니다.

### 장점

-   **성능 향상**: 계산 집약적인(CPU-bound) 코드에서 **2배 ~ 10배 이상**의 속도 향상.
-   **점진적 적용**: 성능이 중요한 특정 모듈만 선택적으로 컴파일 가능.
-   **높은 호환성**: 기존 파이썬 코드를 거의 수정 없이 사용 가능 (타입 힌트 추가 필요).

### 사용 예제

1.  **컴파일할 파일 작성 (`fib_module.py`)**
    ```python
    # fib_module.py
    def fib(n: int) -> int:
        if n <= 1:
            return n
        a, b = 0, 1
        for _ in range(n - 1):
            a, b = b, a + b
        return b
    ```

2.  **Mypyc로 컴파일**
    ```bash
    mypyc fib_module.py
    ```
    (컴파일 후 `.pyd` 또는 `.so` 확장자가 붙은 C 확장 모듈이 생성됩니다.)

3.  **성능 비교 (`main.py`)**
    ```python
    # main.py
    import time
    # Mypyc가 생성한 C 확장 모듈이 자동으로 임포트됨
    from fib_module import fib

    start_time = time.time()
    fib(35)
    print(f"컴파일된 버전 실행 시간: {time.time() - start_time:.4f}s")
    ```
    위 코드를 실행하면 순수 파이썬으로 실행했을 때보다 훨씬 빠른 결과를 확인할 수 있습니다.

### 언제 사용해야 하는가?

-   **적합한 경우 (CPU-bound)**: 복잡한 수학 계산, 알고리즘, 시뮬레이션, 대규모 데이터 처리.
-   **부적합한 경우 (I/O-bound)**: 네트워크 요청, 파일 입출력 등 외부 시스템을 기다리는 시간이 대부분인 작업.

---

## 최종 요약

| 도구 / 기능 | 목적 | 실행 속도에 미치는 영향 |
| :--- | :--- | :--- |
| **타입 힌트** | 코드 안정성, 가독성, 유지보수성 향상 | **변화 없음** |
| **Mypy** | 정적 분석을 통한 사전 오류 검출 | **변화 없음** (실행 전 도구) |
| **Mypyc** | C 코드로 컴파일하여 성능 극대화 | **크게 향상됨** |
